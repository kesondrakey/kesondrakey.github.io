<!DOCTYPE html>
<html>
<head>
    <title>Weather Calendar</title>
    <style>
        body, div {
            font-family: Arial, sans-serif;
            background-color: #232943;
        }
        #calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-gap: 5px;
        }
        .calendar-header, .calendar-cell {
            padding: 10px;
            text-align: center;
            background: linear-gradient(to bottom, #343a54, #232943);
            color: white;
            position: relative;
            min-height: 100px;
        }
        .calendar-header {
            font-weight: bold;
        }
        #monthName {
            text-align: center;
            color: white;
            margin-bottom: 10px;
            font-size: 24px;
        }
        .info-box {
            display: none;
            background-color: #141414;
            color: white;
            position: absolute;
            right: 10px;
            z-index: 1;
            width: 220px;
            padding: 10px;
        }
        .calendar-cell:hover .info-box {
            display: block;
        }
        #controls {
            text-align: right;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div id="monthName"></div>
    <div id="calendar">
        <div class="calendar-header">Sun</div>
        <div class="calendar-header">Mon</div>
        <div class="calendar-header">Tue</div>
        <div class="calendar-header">Wed</div>
        <div class="calendar-header">Thu</div>
        <div class="calendar-header">Fri</div>
        <div class="calendar-header">Sat</div>
        <!-- Populated dynamically -->
    </div>
    <div id="controls">
        <button id="prev">Prev</button>
        <button id="next">Next</button>
    </div>
    <script>
        let currentMonth;
        let currentYear;
        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

        fetch("../files/daily_fluxtower1.json")
            .then(response => response.json())
            .then(jsonData => {
                const mostRecentDate = jsonData.reduce((latest, current) => {
                    return (new Date(latest.DATE) > new Date(current.DATE)) ? latest : current;
                }, jsonData[0]).DATE;

                if (!currentMonth || !currentYear) {
                    [currentYear, currentMonth] = mostRecentDate.split("-").slice(0, 2);
                    document.getElementById('monthName').innerText = `${monthNames[parseInt(currentMonth) - 1]} ${currentYear}`;
                }

                const calendarEl = document.getElementById('calendar');
                const filteredData = jsonData.filter(day => {
                    const [year, month] = day.DATE.split("-").slice(0, 2);
                    return year === currentYear && month === currentMonth;
                }).sort((a, b) => new Date(a.DATE) - new Date(b.DATE));

                filteredData.forEach(day => {
                    const cell = document.createElement('div');
                    cell.className = 'calendar-cell';
                    
                    const dayNumber = day.DATE.split('-')[2];
                    cell.innerHTML = `<small style="position:absolute; top: 10px; left: 10px;">${dayNumber}</small>`;
                    
                    const icon = day.Description === "Sunny" ? "../images/sun.png" : "../images/rain.png";
                    
                    const info = `
                        <div style="display: flex; align-items: center; font-size: 0.9em;">
                            <img src="${icon}" alt="${day.Description}" style="width:30px; height:30px; margin-right:5px;">
                            <div>
                                Max Temp: ${day['Max.Temp']}&#176;F<br>
                                Min Temp: ${day['Min.Temp']}&#176;F
                            </div>
                        </div>
                    `;
                    
                    cell.innerHTML += info;
                    
                    const infoBox = document.createElement('div');
                    infoBox.className = 'info-box';
                    infoBox.innerHTML = `
                        Date: ${day.DATE}<br>
                        Max Temp: ${day['Max.Temp']}&#176;F<br>
                        Min Temp: ${day['Min.Temp']}&#176;F<br>
                        Precipitation: ${day['Total.Precipitation']} in.<br>
                        Soil Moisture: ${day['Avg.Soil.Moisture']}
                    `;
                    
                    cell.appendChild(infoBox);
                    calendarEl.appendChild(cell);
                });
            })
            .catch(error => {
                console.error("Error fetching JSON:", error);
            });
    </script>
</body>
</html>
